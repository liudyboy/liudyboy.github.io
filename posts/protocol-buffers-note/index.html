<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.68.3" /><meta name="theme-color" content="#fff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Protocol Buffers Note | liudy</title>

    <link rel="stylesheet" href="/css/meme.min.ee60e170cedf90d86c927787e2597360b59802242e3845a7d04834f4b534af2b.css" integrity="sha256-7mDhcM7fkNhskneH4llzYLWYAiQuOEWn0Eg09LU0rys=" />

    
    
        <script src="/js/meme.min.434274bb2302fe029f98d3d29ae57dab1566be565436f52a6dd93089085533c4.js" integrity="sha256-Q0J0uyMC/gKfmNPSmuV9qxVmvlZUNvUqbdkwiQhVM8Q="></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" /></noscript>

    <meta name="author" content="liudy" /><meta name="description" content="本文记录 protobuf 的笔记" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="liudy" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="liudy" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    <link rel="canonical" href="https://liudyboy.github.io/posts/protocol-buffers-note/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2021-12-15T10:57:31+08:00",
        "dateModified": "2022-01-12T14:57:51+08:00",
        "url": "https://liudyboy.github.io/posts/protocol-buffers-note/",
        "headline": "Protocol Buffers Note",
        "description": "本文记录 protobuf 的笔记",
        "inLanguage" : "zh-CN",
        "articleSection": "posts",
        "wordCount":  5381 ,
        "image": "https://liudyboy.github.io/icons/apple-touch-icon.png",
        "author": {
            "@type": "Person",
            "description": "Viva La Vida",
            "email": "liudy95@126.com",
            "image": "https://liudyboy.github.io/icons/apple-touch-icon.png",
            "url": "https://liudyboy.github.io/",
            "name": "liudy"
        },
        "license": "[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)",
        "publisher": {
            "@type": "Organization",
            "name": "liudy",
            "logo": {
                "@type": "ImageObject",
                "url": "https://liudyboy.github.io/icons/apple-touch-icon.png"
            },
            "url": "https://liudyboy.github.io/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://liudyboy.github.io/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary" />


    



<meta property="og:title" content="Protocol Buffers Note" />
<meta property="og:description" content="本文记录 protobuf 的笔记" />
<meta property="og:url" content="https://liudyboy.github.io/posts/protocol-buffers-note/" />
<meta property="og:site_name" content="liudy" />
<meta property="og:locale" content="zh" /><meta property="og:image" content="https://liudyboy.github.io/icons/apple-touch-icon.png" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-12-15T10:57:31&#43;08:00" />
    <meta property="article:modified_time" content="2022-01-12T14:57:51&#43;08:00" />
    
    <meta property="article:section" content="posts" />



     <script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
 MathJax.Hub.Config({
     tex2jax: {
         inlineMath: [['$','$'], ['\\(','\\)']],
         displayMath: [['$$','$$'], ['\[\[','\]\]']],
         processEscapes: true,
         processEnvironments: true,
         skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
         TeX: { equationNumbers: { autoNumber: "AMS" },
                extensions: ["AMSmath.js", "AMSsymbols.js"] }
     }
 });

 MathJax.Hub.Queue(function() {
     
     
     
     var all = MathJax.Hub.getAllJax(), i;
     for(i = 0; i < all.length; i += 1) {
         all[i].SourceElement().parentNode.className += ' has-jax';
     }
 });

</script>

<style>
 code.has-jax {
     font: inherit;
     font-size: 100%;
     background: inherit;
     border: inherit;
     color: #515151;
 }
</style>


   
</head>

    <body>
        <div class="container">
            
    <header class="header" data-scroll-header>
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">liudy</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item active"><a href="/posts/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class="menu-item-name">文章</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255 0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm386.667-56H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24z"/></svg><span class="menu-item-name">分类</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg><span class="menu-item-name">标签</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class="menu-item-name">关于</span></a>
                </li>
            
        
            
                
                    
                    
                        <li class="menu-item">
                            <a id="theme-switcher" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5l48.8-97.5a18 18 0 0128 0l48.8 97.5 103.4 -34.5a18 18 0 0119.8 19.8l-34.5 103.4l97.5 48.8a18 18 0 010 28l-97.5 48.8 34.5 103.4a18 18 0 01-19.8 19.8l-103.4-34.5-48.8 97.5a18 18 0 01-28 0l-48.8-97.5l-103.4 34.5a18 18 0 01-19.8-19.8l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8-34.5-103.4a18 18 0 0119.8-19.8zM256 128a128 128 0 10.01 0M256 160a96 96 0 10.01 0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412a256 256 0 10154-407a11.5 11.5 0 00-5 20a201.5 201.5 0 01-134 374a11.5 11.5 0 00-15 13"/></svg></a>
                        </li>
                    
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post" data-align="default" data-type="posts" data-toc-num="true">

            <h1 class="post-title">Protocol Buffers Note</h1>

            

            
                <div class="post-description">本文记录 protobuf 的笔记</div>
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2021-12-15T10:57:31&#43;08:00" class="post-meta-item published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;2021.12.15</time>
    
    
        
        <time datetime="2022-01-12T14:57:51&#43;08:00" class="post-meta-item modified"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M400 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V160h352v298a6 6 0 0 1-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2022.1.12</time>
    
    
    
        
        
        
            
                <span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href="/categories/programing/" class="category-link">Programing</a></span>
            
        
    
    
        
        <span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;5381</span>
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;11&nbsp;分钟</span>
    
    
        
            
            <span class="post-meta-item busuanzi-page-pv" id="busuanzi_container_page_pv"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon post-meta-icon"><path d="M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"/></svg>&nbsp;<span id="busuanzi_value_page_pv"></span></span>
        
    
    
</div>

            

            <nav class="contents">
  <h2 id="contents" class="contents-title">目录</h2><ol class="toc">
    <li><a href="#protocol-buffers">Protocol Buffers</a>
      <ol>
        <li><a href="#basisi">basisi</a></li>
        <li><a href="#oneof">oneof</a></li>
      </ol>
    </li>
    <li><a href="#grpc">Grpc</a>
      <ol>
        <li><a href="#同步调用">同步调用</a></li>
        <li><a href="#异步调用">异步调用</a></li>
      </ol>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ol>
</nav><div class="post-body">
              <h2 id="protocol-buffers"><a href="#protocol-buffers" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Protocol Buffers</h2>
<h3 id="basisi"><a href="#basisi" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>basisi</h3>
<p>Scalar Value Types</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="center">.proto Type</th>
<th align="center">Notes</th>
<th align="center">C++ Type</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">double</td>
<td align="center">---</td>
<td align="center">double</td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">---</td>
<td align="center">float</td>
</tr>
<tr>
<td align="center">int32</td>
<td align="center">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead</td>
<td align="center">int32</td>
</tr>
<tr>
<td align="center">int64</td>
<td align="center">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead</td>
<td align="center">int64</td>
</tr>
<tr>
<td align="center">uint32</td>
<td align="center">Uses variable-length encoding.</td>
<td align="center">uint32</td>
</tr>
<tr>
<td align="center">uint64</td>
<td align="center">Uses variable-length encoding.</td>
<td align="center">uint64</td>
</tr>
<tr>
<td align="center">sint32</td>
<td align="center">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.</td>
<td align="center">int32</td>
</tr>
<tr>
<td align="center">sint64</td>
<td align="center">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.</td>
<td align="center">int64</td>
</tr>
<tr>
<td align="center">fixed32</td>
<td align="center">Always four bytes. More efficient than uint32 if values are often greater than 228.</td>
<td align="center">uint32</td>
</tr>
<tr>
<td align="center">fixed64</td>
<td align="center">Always eight bytes. More efficient than uint64 if values are often greater than 256.</td>
<td align="center">uint64</td>
</tr>
<tr>
<td align="center">sfixed32</td>
<td align="center">Always four bytes.</td>
<td align="center">int32</td>
</tr>
<tr>
<td align="center">sfixed64</td>
<td align="center">Always eight bytes</td>
<td align="center">int64</td>
</tr>
<tr>
<td align="center">bool</td>
<td align="center">---</td>
<td align="center">bool</td>
</tr>
<tr>
<td align="center">string</td>
<td align="center">A string must always contain UTF-8 encoded or 7-bit ASCII text, and cannot be longer than 232.</td>
<td align="center">string</td>
</tr>
<tr>
<td align="center">bytes</td>
<td align="center">May contain any arbitrary sequence of bytes no longer than 232.</td>
<td align="center">string</td>
</tr>
</tbody>
</table></div>
<ul>
<li><code>package</code></li>
</ul>
<p>package声明符，用来防止不同的消息类型有命名冲突</p>
<pre><code>package foo.bar;
message Open { ... }
</code></pre><p>其他的消息格式定义中可以使用包名+消息名的方式来定义域的类型，如：</p>
<pre><code>message Foo {
  ...
  required foo.bar.Open open = 1;
  ...
}
</code></pre><p>对于C++，产生的类会被包装在C++的命名空间中，如上例中的Open会被封装在 foo::bar空间中；
对于Java，包声明符会变为java的一个包，除非在.proto文件中提供了一个明确有java_package；
对于 Python，这个包声明符是被忽略的，因为Python模块是按照其在文件系统中的位置进行组织的。</p>
<h3 id="oneof"><a href="#oneof" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>oneof</h3>
<p>Oneof fields are like regular fields except all the fields in a oneof share memory, and at most one field can be set at the same time. Setting any member of the oneof automatically clears all the other members.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">message</span> <span class="n">SampleMessage</span> <span class="p">{</span>
    <span class="n">oneof</span> <span class="n">test_oneof</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">SubMessage</span> <span class="n">sub_message</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">SampleMessage</span> <span class="n">message</span><span class="p">;</span>
<span class="n">SubMessage</span><span class="o">*</span> <span class="n">sub_message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">mutable_sub_message</span><span class="p">();</span>
<span class="n">message</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">);</span>   <span class="c1">// Will delete sub_message
</span><span class="c1"></span><span class="n">sub_message</span><span class="o">-&gt;</span><span class="n">set_</span><span class="p">...</span>      <span class="c1">// Crashes here
</span></code></pre></td></tr></table></div>
</div>
</div><p>if you <code>Swap()</code> two messages with oneofs, each will end up with the other's oneof case</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">SampleMessage</span> <span class="n">msg1</span><span class="p">;</span>
<span class="n">msg1</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">);</span>
<span class="n">SampleMessage</span> <span class="n">msg2</span><span class="p">;</span>
<span class="n">msg2</span><span class="p">.</span><span class="n">mutable_sub_message</span><span class="p">();</span>
<span class="n">msg1</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg2</span><span class="p">);</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">msg1</span><span class="p">.</span><span class="n">has_sub_message</span><span class="p">());</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">msg2</span><span class="p">.</span><span class="n">has_name</span><span class="p">());</span>
</code></pre></td></tr></table></div>
</div>
</div><p><strong>Large Data Sets:</strong> Protocol Buffers are not designed to handle large messages. As a general rule of thumb, if you are dealing in messages larger than 1 megabyte each, it may be time to condider an alternate strategy.</p>
<p>addressbook.proto example. (basics c++)</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto2&#34;</span><span class="p">;</span>

<span class="n">package</span> <span class="n">tutorial</span><span class="p">;</span>

<span class="n">message</span> <span class="n">Person</span> <span class="p">{</span>
  <span class="n">optional</span> <span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">optional</span> <span class="n">int32</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">optional</span> <span class="n">string</span> <span class="n">email</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="k">enum</span> <span class="nc">PhoneType</span> <span class="p">{</span>
    <span class="n">MOBILE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">HOME</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">WORK</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">message</span> <span class="n">PhoneNumber</span> <span class="p">{</span>
    <span class="n">optional</span> <span class="n">string</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">optional</span> <span class="n">PhoneType</span> <span class="n">type</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="k">default</span> <span class="o">=</span> <span class="n">HOME</span><span class="p">];</span>  <span class="c1">// set default value
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="n">repeated</span> <span class="n">PhoneNumber</span> <span class="n">phones</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">message</span> <span class="n">AddressBook</span> <span class="p">{</span>
  <span class="n">repeated</span> <span class="n">Person</span> <span class="n">people</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><p>compiling</p>
<pre><code>protoc -I=$SRC_DIR --cpp_out=$DST_DIR $SRC_DIR/addressbook.proto
</code></pre><p>This generates the following files in your specified destination directory:</p>
<ul>
<li>addressbook.pb.h, the header which declares your generated classes.</li>
<li>addressbook.pb.cc, which contains the implementation of your classes.</li>
</ul>
<p>Let's look at some of the generated code and see what classes and functions the compiler has created for you</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++">  <span class="c1">// name
</span><span class="c1"></span>  <span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">has_name</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clear_name</span><span class="p">();</span>
  <span class="kr">inline</span> <span class="k">const</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_name</span><span class="p">(</span><span class="k">const</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_name</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">);</span>
  <span class="kr">inline</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">mutable_name</span><span class="p">();</span>

  <span class="c1">// id
</span><span class="c1"></span>  <span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">has_id</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clear_id</span><span class="p">();</span>
  <span class="kr">inline</span> <span class="kt">int32_t</span> <span class="nf">id</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_id</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">value</span><span class="p">);</span>

  <span class="c1">// email
</span><span class="c1"></span>  <span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">has_email</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clear_email</span><span class="p">();</span>
  <span class="kr">inline</span> <span class="k">const</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">email</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_email</span><span class="p">(</span><span class="k">const</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_email</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">);</span>
  <span class="kr">inline</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">mutable_email</span><span class="p">();</span>

  <span class="c1">// phones
</span><span class="c1"></span>  <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">phones_size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clear_phones</span><span class="p">();</span>
  <span class="kr">inline</span> <span class="k">const</span> <span class="o">::</span><span class="n">google</span><span class="o">::</span><span class="n">protobuf</span><span class="o">::</span><span class="n">RepeatedPtrField</span><span class="o">&lt;</span> <span class="o">::</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person_PhoneNumber</span> <span class="o">&gt;&amp;</span> <span class="n">phones</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="o">::</span><span class="n">google</span><span class="o">::</span><span class="n">protobuf</span><span class="o">::</span><span class="n">RepeatedPtrField</span><span class="o">&lt;</span> <span class="o">::</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person_PhoneNumber</span> <span class="o">&gt;*</span> <span class="n">mutable_phones</span><span class="p">();</span>
  <span class="kr">inline</span> <span class="k">const</span> <span class="o">::</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person_PhoneNumber</span><span class="o">&amp;</span> <span class="n">phones</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="kr">inline</span> <span class="o">::</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person_PhoneNumber</span><span class="o">*</span> <span class="n">mutable_phones</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
  <span class="kr">inline</span> <span class="o">::</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person_PhoneNumber</span><span class="o">*</span> <span class="n">add_phones</span><span class="p">();</span>
</code></pre></td></tr></table></div>
</div>
</div><p>As you can see, the getters have exactly the name as the field in lowercase, and the setter methods begin with set_. There are also has_ methods for each singular (required or optional) field which return true if that field has been set. Finally, each field has a clear_ method that un-sets the field back to its empty state.</p>
<p>While the numeric id field just has the basic accessor set described above, the name and email fields have a couple of extra methods because they're strings – a mutable_ getter that lets you get a direct pointer to the string, and an extra setter. Note that you can call mutable_email() even if email is not already set; it will be initialized to an empty string automatically. If you had a singular message field in this example, it would also have a mutable_ method but not a set_ method.</p>
<p>Repeated fields also have some special methods – if you look at the methods for the repeated phones field, you'll see that you can</p>
<p>check the repeated field's <em>size (in other words, how many phone numbers are associated with this Person).
get a specified phone number using its index.
update an existing phone number at the specified index.
add another phone number to the message which you can then edit (repeated scalar types have an add</em> that just lets you pass in the new value).</p>
<p>The generated code includes a PhoneType enum that corresponds to your .proto enum. You can refer to this type as Person::PhoneType and its values as Person::MOBILE, Person::HOME, and Person::WORK (the implementation details are a little more complicated, but you don't need to understand them to use the enum).</p>
<p>Each message class also contains a number of other methods that let you check or manipulate the entire message, including:</p>
<ul>
<li>bool IsInitialized() const;: checks if all the required fields have been set.</li>
<li>string DebugString() const;: returns a human-readable representation of the message, particularly useful for debugging.</li>
<li>void CopyFrom(const Person&amp; from);: overwrites the message with the given message's values.</li>
<li>void Clear();: clears all the elements back to the empty state.</li>
</ul>
<p>Writing A Message</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;addressbook.pb.h&#34;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="c1">// This function fills in a Person message based on user input.
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">PromptForAddress</span><span class="p">(</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">*</span> <span class="n">person</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Enter person ID number: &#34;</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">id</span><span class="p">;</span>
  <span class="n">person</span><span class="o">-&gt;</span><span class="n">set_id</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
  <span class="n">cin</span><span class="p">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>

  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Enter name: &#34;</span><span class="p">;</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="o">*</span><span class="n">person</span><span class="o">-&gt;</span><span class="n">mutable_name</span><span class="p">());</span>

  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Enter email address (blank for none): &#34;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">email</span><span class="p">;</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">email</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">email</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">person</span><span class="o">-&gt;</span><span class="n">set_email</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Enter a phone number (or leave blank to finish): &#34;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">number</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="n">PhoneNumber</span><span class="o">*</span> <span class="n">phone_number</span> <span class="o">=</span> <span class="n">person</span><span class="o">-&gt;</span><span class="n">add_phones</span><span class="p">();</span>
    <span class="n">phone_number</span><span class="o">-&gt;</span><span class="n">set_number</span><span class="p">(</span><span class="n">number</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Is this a mobile, home, or work phone? &#34;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#34;mobile&#34;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">phone_number</span><span class="o">-&gt;</span><span class="n">set_type</span><span class="p">(</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="n">MOBILE</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#34;home&#34;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">phone_number</span><span class="o">-&gt;</span><span class="n">set_type</span><span class="p">(</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="n">HOME</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#34;work&#34;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">phone_number</span><span class="o">-&gt;</span><span class="n">set_type</span><span class="p">(</span><span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="n">WORK</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Unknown phone type.  Using default.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Main function:  Reads the entire address book from a file,
</span><span class="c1">//   adds one person based on user input, then writes it back out to the same
</span><span class="c1">//   file.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Verify that the version of the library that we linked against is
</span><span class="c1"></span>  <span class="c1">// compatible with the version of the headers we compiled against.
</span><span class="c1"></span>  <span class="n">GOOGLE_PROTOBUF_VERIFY_VERSION</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Usage:  &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; ADDRESS_BOOK_FILE&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">tutorial</span><span class="o">::</span><span class="n">AddressBook</span> <span class="n">address_book</span><span class="p">;</span>

  <span class="p">{</span>
    <span class="c1">// Read the existing address book.
</span><span class="c1"></span>    <span class="n">fstream</span> <span class="n">input</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;: File not found.  Creating a new file.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">address_book</span><span class="p">.</span><span class="n">ParseFromIstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">input</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Failed to parse address book.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Add an address.
</span><span class="c1"></span>  <span class="n">PromptForAddress</span><span class="p">(</span><span class="n">address_book</span><span class="p">.</span><span class="n">add_people</span><span class="p">());</span>

  <span class="p">{</span>
    <span class="c1">// Write the new address book back to disk.
</span><span class="c1"></span>    <span class="n">fstream</span> <span class="n">output</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">trunc</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">address_book</span><span class="p">.</span><span class="n">SerializeToOstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Failed to write address book.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Optional:  Delete all global objects allocated by libprotobuf.
</span><span class="c1"></span>  <span class="n">google</span><span class="o">::</span><span class="n">protobuf</span><span class="o">::</span><span class="n">ShutdownProtobufLibrary</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><p>Reading A Message</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;addressbook.pb.h&#34;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="c1">// Iterates though all people in the AddressBook and prints info about them.
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">ListPeople</span><span class="p">(</span><span class="k">const</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">AddressBook</span><span class="o">&amp;</span> <span class="n">address_book</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">address_book</span><span class="p">.</span><span class="n">people_size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">&amp;</span> <span class="n">person</span> <span class="o">=</span> <span class="n">address_book</span><span class="p">.</span><span class="n">people</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Person ID: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">id</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  Name: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="n">has_email</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  E-mail address: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">email</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">phones_size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="n">PhoneNumber</span><span class="o">&amp;</span> <span class="n">phone_number</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="n">phones</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>

      <span class="k">switch</span> <span class="p">(</span><span class="n">phone_number</span><span class="p">.</span><span class="n">type</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="nl">MOBILE</span><span class="p">:</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  Mobile phone #: &#34;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="nl">HOME</span><span class="p">:</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  Home phone #: &#34;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">tutorial</span><span class="o">::</span><span class="n">Person</span><span class="o">::</span><span class="nl">WORK</span><span class="p">:</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  Work phone #: &#34;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">phone_number</span><span class="p">.</span><span class="n">number</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Main function:  Reads the entire address book from a file and prints all
</span><span class="c1">//   the information inside.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Verify that the version of the library that we linked against is
</span><span class="c1"></span>  <span class="c1">// compatible with the version of the headers we compiled against.
</span><span class="c1"></span>  <span class="n">GOOGLE_PROTOBUF_VERIFY_VERSION</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Usage:  &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; ADDRESS_BOOK_FILE&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">tutorial</span><span class="o">::</span><span class="n">AddressBook</span> <span class="n">address_book</span><span class="p">;</span>

  <span class="p">{</span>
    <span class="c1">// Read the existing address book.
</span><span class="c1"></span>    <span class="n">fstream</span> <span class="n">input</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">address_book</span><span class="p">.</span><span class="n">ParseFromIstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">input</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Failed to parse address book.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">ListPeople</span><span class="p">(</span><span class="n">address_book</span><span class="p">);</span>

  <span class="c1">// Optional:  Delete all global objects allocated by libprotobuf.
</span><span class="c1"></span>  <span class="n">google</span><span class="o">::</span><span class="n">protobuf</span><span class="o">::</span><span class="n">ShutdownProtobufLibrary</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><h2 id="grpc"><a href="#grpc" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Grpc</h2>
<h3 id="同步调用"><a href="#同步调用" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>同步调用</h3>
<p>proto file</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span>

<span class="n">option</span> <span class="n">java_multiple_files</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">option</span> <span class="n">java_package</span> <span class="o">=</span> <span class="s">&#34;io.grpc.examples.routeguide&#34;</span><span class="p">;</span>
<span class="n">option</span> <span class="n">java_outer_classname</span> <span class="o">=</span> <span class="s">&#34;RouteGuideProto&#34;</span><span class="p">;</span>
<span class="n">option</span> <span class="n">objc_class_prefix</span> <span class="o">=</span> <span class="s">&#34;RTG&#34;</span><span class="p">;</span>

<span class="n">package</span> <span class="n">routeguide</span><span class="p">;</span>

<span class="c1">// Interface exported by the server.
</span><span class="c1"></span><span class="n">service</span> <span class="n">RouteGuide</span> <span class="p">{</span>
  <span class="c1">// A simple RPC.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">// Obtains the feature at a given position.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">// A feature with an empty name is returned if there&#39;s no feature at the given
</span><span class="c1"></span>  <span class="c1">// position.
</span><span class="c1"></span>  <span class="n">rpc</span> <span class="nf">GetFeature</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span> <span class="n">returns</span> <span class="p">(</span><span class="n">Feature</span><span class="p">)</span> <span class="p">{}</span>

  <span class="c1">// A server-to-client streaming RPC.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">// Obtains the Features available within the given Rectangle.  Results are
</span><span class="c1"></span>  <span class="c1">// streamed rather than returned at once (e.g. in a response message with a
</span><span class="c1"></span>  <span class="c1">// repeated field), as the rectangle may cover a large area and contain a
</span><span class="c1"></span>  <span class="c1">// huge number of features.
</span><span class="c1"></span>  <span class="n">rpc</span> <span class="nf">ListFeatures</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">)</span> <span class="n">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">Feature</span><span class="p">)</span> <span class="p">{}</span>

  <span class="c1">// A client-to-server streaming RPC.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">// Accepts a stream of Points on a route being traversed, returning a
</span><span class="c1"></span>  <span class="c1">// RouteSummary when traversal is completed.
</span><span class="c1"></span>  <span class="n">rpc</span> <span class="nf">RecordRoute</span><span class="p">(</span><span class="n">stream</span> <span class="n">Point</span><span class="p">)</span> <span class="n">returns</span> <span class="p">(</span><span class="n">RouteSummary</span><span class="p">)</span> <span class="p">{}</span>

  <span class="c1">// A Bidirectional streaming RPC.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">// Accepts a stream of RouteNotes sent while a route is being traversed,
</span><span class="c1"></span>  <span class="c1">// while receiving other RouteNotes (e.g. from other users).
</span><span class="c1"></span>  <span class="n">rpc</span> <span class="nf">RouteChat</span><span class="p">(</span><span class="n">stream</span> <span class="n">RouteNote</span><span class="p">)</span> <span class="n">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">RouteNote</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Points are represented as latitude-longitude pairs in the E7 representation
</span><span class="c1">// (degrees multiplied by 10**7 and rounded to the nearest integer).
</span><span class="c1">// Latitudes should be in the range +/- 90 degrees and longitude should be in
</span><span class="c1">// the range +/- 180 degrees (inclusive).
</span><span class="c1"></span><span class="n">message</span> <span class="n">Point</span> <span class="p">{</span>
  <span class="n">int32</span> <span class="n">latitude</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">int32</span> <span class="n">longitude</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A latitude-longitude rectangle, represented as two diagonally opposite
</span><span class="c1">// points &#34;lo&#34; and &#34;hi&#34;.
</span><span class="c1"></span><span class="n">message</span> <span class="n">Rectangle</span> <span class="p">{</span>
  <span class="c1">// One corner of the rectangle.
</span><span class="c1"></span>  <span class="n">Point</span> <span class="n">lo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The other corner of the rectangle.
</span><span class="c1"></span>  <span class="n">Point</span> <span class="n">hi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A feature names something at a given point.
</span><span class="c1">//
</span><span class="c1">// If a feature could not be named, the name is empty.
</span><span class="c1"></span><span class="n">message</span> <span class="n">Feature</span> <span class="p">{</span>
  <span class="c1">// The name of the feature.
</span><span class="c1"></span>  <span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The point where the feature is detected.
</span><span class="c1"></span>  <span class="n">Point</span> <span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A RouteNote is a message sent while at a given point.
</span><span class="c1"></span><span class="n">message</span> <span class="n">RouteNote</span> <span class="p">{</span>
  <span class="c1">// The location from which the message is sent.
</span><span class="c1"></span>  <span class="n">Point</span> <span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The message to be sent.
</span><span class="c1"></span>  <span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A RouteSummary is received in response to a RecordRoute rpc.
</span><span class="c1">//
</span><span class="c1">// It contains the number of individual points received, the number of
</span><span class="c1">// detected features, and the total distance covered as the cumulative sum of
</span><span class="c1">// the distance between each point.
</span><span class="c1"></span><span class="n">message</span> <span class="n">RouteSummary</span> <span class="p">{</span>
  <span class="c1">// The number of points received.
</span><span class="c1"></span>  <span class="n">int32</span> <span class="n">point_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The number of known features passed while traversing the route.
</span><span class="c1"></span>  <span class="n">int32</span> <span class="n">feature_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// The distance covered in metres.
</span><span class="c1"></span>  <span class="n">int32</span> <span class="n">distance</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="c1">// The duration of the traversal in seconds.
</span><span class="c1"></span>  <span class="n">int32</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><p>Server</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&#34;helper.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;grpc/grpc.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/security/server_credentials.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/server.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/server_builder.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/server_context.h&gt;</span><span class="cp">
</span><span class="cp">#ifdef BAZEL_BUILD
</span><span class="cp">#include</span> <span class="cpf">&#34;examples/protos/route_guide.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#else
</span><span class="cp">#include</span> <span class="cpf">&#34;route_guide.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#endif
</span><span class="cp"></span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Server</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerBuilder</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerContext</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerReader</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerReaderWriter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerWriter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Feature</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Point</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Rectangle</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteGuide</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteNote</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteSummary</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="p">;</span>

<span class="kt">float</span> <span class="nf">ConvertToRadians</span><span class="p">(</span><span class="kt">float</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">num</span> <span class="o">*</span> <span class="mf">3.1415926</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// The formula is based on http://mathforum.org/library/drmath/view/51879.html
</span><span class="c1"></span><span class="kt">float</span> <span class="nf">GetDistance</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">start</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">float</span> <span class="n">kCoordFactor</span> <span class="o">=</span> <span class="mf">10000000.0</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">lat_1</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">lat_2</span> <span class="o">=</span> <span class="n">end</span><span class="p">.</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">lon_1</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">lon_2</span> <span class="o">=</span> <span class="n">end</span><span class="p">.</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">lat_rad_1</span> <span class="o">=</span> <span class="n">ConvertToRadians</span><span class="p">(</span><span class="n">lat_1</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">lat_rad_2</span> <span class="o">=</span> <span class="n">ConvertToRadians</span><span class="p">(</span><span class="n">lat_2</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">delta_lat_rad</span> <span class="o">=</span> <span class="n">ConvertToRadians</span><span class="p">(</span><span class="n">lat_2</span> <span class="o">-</span> <span class="n">lat_1</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">delta_lon_rad</span> <span class="o">=</span> <span class="n">ConvertToRadians</span><span class="p">(</span><span class="n">lon_2</span> <span class="o">-</span> <span class="n">lon_1</span><span class="p">);</span>

  <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_lat_rad</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">cos</span><span class="p">(</span><span class="n">lat_rad_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat_rad_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_lon_rad</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">));</span>
  <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="mi">6371000</span><span class="p">;</span>  <span class="c1">// metres
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetFeatureName</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">point</span><span class="p">,</span>
                           <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;&amp;</span> <span class="n">feature_list</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Feature</span><span class="o">&amp;</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">feature_list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">==</span> <span class="n">point</span><span class="p">.</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
        <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">==</span> <span class="n">point</span><span class="p">.</span><span class="n">longitude</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">RouteGuideImpl</span> <span class="k">final</span> <span class="o">:</span> <span class="k">public</span> <span class="n">RouteGuide</span><span class="o">::</span><span class="n">Service</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">RouteGuideImpl</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">routeguide</span><span class="o">::</span><span class="n">ParseDb</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">feature_list_</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Status</span> <span class="nf">GetFeature</span><span class="p">(</span><span class="n">ServerContext</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span><span class="o">*</span> <span class="n">point</span><span class="p">,</span>
                    <span class="n">Feature</span><span class="o">*</span> <span class="n">feature</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">feature</span><span class="o">-&gt;</span><span class="n">set_name</span><span class="p">(</span><span class="n">GetFeatureName</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">,</span> <span class="n">feature_list_</span><span class="p">));</span>
    <span class="n">feature</span><span class="o">-&gt;</span><span class="n">mutable_location</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Status</span> <span class="nf">ListFeatures</span><span class="p">(</span><span class="n">ServerContext</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span>
                      <span class="k">const</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Rectangle</span><span class="o">*</span> <span class="n">rectangle</span><span class="p">,</span>
                      <span class="n">ServerWriter</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;*</span> <span class="n">writer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">lo</span> <span class="o">=</span> <span class="n">rectangle</span><span class="o">-&gt;</span><span class="n">lo</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">rectangle</span><span class="o">-&gt;</span><span class="n">hi</span><span class="p">();</span>
    <span class="kt">long</span> <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">)(</span><span class="n">lo</span><span class="p">.</span><span class="n">longitude</span><span class="p">(),</span> <span class="n">hi</span><span class="p">.</span><span class="n">longitude</span><span class="p">());</span>
    <span class="kt">long</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">)(</span><span class="n">lo</span><span class="p">.</span><span class="n">longitude</span><span class="p">(),</span> <span class="n">hi</span><span class="p">.</span><span class="n">longitude</span><span class="p">());</span>
    <span class="kt">long</span> <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">)(</span><span class="n">lo</span><span class="p">.</span><span class="n">latitude</span><span class="p">(),</span> <span class="n">hi</span><span class="p">.</span><span class="n">latitude</span><span class="p">());</span>
    <span class="kt">long</span> <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">)(</span><span class="n">lo</span><span class="p">.</span><span class="n">latitude</span><span class="p">(),</span> <span class="n">hi</span><span class="p">.</span><span class="n">latitude</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Feature</span><span class="o">&amp;</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">feature_list_</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">left</span> <span class="o">&amp;&amp;</span>
          <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">right</span> <span class="o">&amp;&amp;</span>
          <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">bottom</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">top</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">writer</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Status</span> <span class="nf">RecordRoute</span><span class="p">(</span><span class="n">ServerContext</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span> <span class="n">ServerReader</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;*</span> <span class="n">reader</span><span class="p">,</span>
                     <span class="n">RouteSummary</span><span class="o">*</span> <span class="n">summary</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">Point</span> <span class="n">point</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">point_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">feature_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">Point</span> <span class="n">previous</span><span class="p">;</span>

    <span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="o">-&gt;</span><span class="n">Read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">point</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">point_count</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetFeatureName</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">feature_list_</span><span class="p">).</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">feature_count</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">point_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">distance</span> <span class="o">+=</span> <span class="n">GetDistance</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">previous</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">summary</span><span class="o">-&gt;</span><span class="n">set_point_count</span><span class="p">(</span><span class="n">point_count</span><span class="p">);</span>
    <span class="n">summary</span><span class="o">-&gt;</span><span class="n">set_feature_count</span><span class="p">(</span><span class="n">feature_count</span><span class="p">);</span>
    <span class="n">summary</span><span class="o">-&gt;</span><span class="n">set_distance</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">distance</span><span class="p">));</span>
    <span class="k">auto</span> <span class="n">secs</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">);</span>
    <span class="n">summary</span><span class="o">-&gt;</span><span class="n">set_elapsed_time</span><span class="p">(</span><span class="n">secs</span><span class="p">.</span><span class="n">count</span><span class="p">());</span>

    <span class="k">return</span> <span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Status</span> <span class="nf">RouteChat</span><span class="p">(</span><span class="n">ServerContext</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span>
                   <span class="n">ServerReaderWriter</span><span class="o">&lt;</span><span class="n">RouteNote</span><span class="p">,</span> <span class="n">RouteNote</span><span class="o">&gt;*</span> <span class="n">stream</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">RouteNote</span> <span class="n">note</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">stream</span><span class="o">-&gt;</span><span class="n">Read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">note</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">mu_</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">RouteNote</span><span class="o">&amp;</span> <span class="nl">n</span> <span class="p">:</span> <span class="n">received_notes_</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">==</span> <span class="n">note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
            <span class="n">n</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">==</span> <span class="n">note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">())</span> <span class="p">{</span>
          <span class="n">stream</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">received_notes_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">note</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;</span> <span class="n">feature_list_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">mu_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">RouteNote</span><span class="o">&gt;</span> <span class="n">received_notes_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">RunServer</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">db_path</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">server_address</span><span class="p">(</span><span class="s">&#34;0.0.0.0:50051&#34;</span><span class="p">);</span>
  <span class="n">RouteGuideImpl</span> <span class="n">service</span><span class="p">(</span><span class="n">db_path</span><span class="p">);</span>

  <span class="n">ServerBuilder</span> <span class="n">builder</span><span class="p">;</span>
  <span class="n">builder</span><span class="p">.</span><span class="n">AddListeningPort</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">grpc</span><span class="o">::</span><span class="n">InsecureServerCredentials</span><span class="p">());</span>
  <span class="n">builder</span><span class="p">.</span><span class="n">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Server</span><span class="o">&gt;</span> <span class="n">server</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">BuildAndStart</span><span class="p">());</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Server listening on &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">server_address</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">server</span><span class="o">-&gt;</span><span class="n">Wait</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Expect only arg: --db_path=path/to/route_guide_db.json.
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">db</span> <span class="o">=</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">GetDbFileContent</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">RunServer</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></td></tr></table></div>
</div>
</div><p>Client</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&#34;helper.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;grpc/grpc.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/channel.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/client_context.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/create_channel.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/security/credentials.h&gt;</span><span class="cp">
</span><span class="cp">#ifdef BAZEL_BUILD
</span><span class="cp">#include</span> <span class="cpf">&#34;examples/protos/route_guide.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#else
</span><span class="cp">#include</span> <span class="cpf">&#34;route_guide.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#endif
</span><span class="cp"></span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Channel</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientContext</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientReader</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientReaderWriter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientWriter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Feature</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Point</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">Rectangle</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteGuide</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteNote</span><span class="p">;</span>
<span class="k">using</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">RouteSummary</span><span class="p">;</span>

<span class="n">Point</span> <span class="nf">MakePoint</span><span class="p">(</span><span class="kt">long</span> <span class="n">latitude</span><span class="p">,</span> <span class="kt">long</span> <span class="n">longitude</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Point</span> <span class="n">p</span><span class="p">;</span>
  <span class="n">p</span><span class="p">.</span><span class="n">set_latitude</span><span class="p">(</span><span class="n">latitude</span><span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">set_longitude</span><span class="p">(</span><span class="n">longitude</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Feature</span> <span class="nf">MakeFeature</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">long</span> <span class="n">latitude</span><span class="p">,</span> <span class="kt">long</span> <span class="n">longitude</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Feature</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">f</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
  <span class="n">f</span><span class="p">.</span><span class="n">mutable_location</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">MakePoint</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">RouteNote</span> <span class="nf">MakeRouteNote</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">,</span> <span class="kt">long</span> <span class="n">latitude</span><span class="p">,</span>
                        <span class="kt">long</span> <span class="n">longitude</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">RouteNote</span> <span class="n">n</span><span class="p">;</span>
  <span class="n">n</span><span class="p">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
  <span class="n">n</span><span class="p">.</span><span class="n">mutable_location</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">MakePoint</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">RouteGuideClient</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">RouteGuideClient</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Channel</span><span class="o">&gt;</span> <span class="n">channel</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">db</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">stub_</span><span class="p">(</span><span class="n">RouteGuide</span><span class="o">::</span><span class="n">NewStub</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">routeguide</span><span class="o">::</span><span class="n">ParseDb</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">feature_list_</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">GetFeature</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Point</span> <span class="n">point</span><span class="p">;</span>
    <span class="n">Feature</span> <span class="n">feature</span><span class="p">;</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">MakePoint</span><span class="p">(</span><span class="mi">409146138</span><span class="p">,</span> <span class="o">-</span><span class="mi">746188906</span><span class="p">);</span>
    <span class="n">GetOneFeature</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">feature</span><span class="p">);</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">MakePoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">GetOneFeature</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">feature</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">ListFeatures</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">routeguide</span><span class="o">::</span><span class="n">Rectangle</span> <span class="n">rect</span><span class="p">;</span>
    <span class="n">Feature</span> <span class="n">feature</span><span class="p">;</span>
    <span class="n">ClientContext</span> <span class="n">context</span><span class="p">;</span>

    <span class="n">rect</span><span class="p">.</span><span class="n">mutable_lo</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_latitude</span><span class="p">(</span><span class="mi">400000000</span><span class="p">);</span>
    <span class="n">rect</span><span class="p">.</span><span class="n">mutable_lo</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_longitude</span><span class="p">(</span><span class="o">-</span><span class="mi">750000000</span><span class="p">);</span>
    <span class="n">rect</span><span class="p">.</span><span class="n">mutable_hi</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_latitude</span><span class="p">(</span><span class="mi">420000000</span><span class="p">);</span>
    <span class="n">rect</span><span class="p">.</span><span class="n">mutable_hi</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_longitude</span><span class="p">(</span><span class="o">-</span><span class="mi">730000000</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Looking for features between 40, -75 and 42, -73&#34;</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ClientReader</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">reader</span><span class="p">(</span>
        <span class="n">stub_</span><span class="o">-&gt;</span><span class="n">ListFeatures</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span> <span class="n">rect</span><span class="p">));</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="o">-&gt;</span><span class="n">Read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">feature</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Found feature called &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; at &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">reader</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;ListFeatures rpc succeeded.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;ListFeatures rpc failed.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">RecordRoute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Point</span> <span class="n">point</span><span class="p">;</span>
    <span class="n">RouteSummary</span> <span class="n">stats</span><span class="p">;</span>
    <span class="n">ClientContext</span> <span class="n">context</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">kPoints</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">().</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">default_random_engine</span> <span class="n">generator</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">feature_distribution</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">feature_list_</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">delay_distribution</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ClientWriter</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">writer</span><span class="p">(</span>
        <span class="n">stub_</span><span class="o">-&gt;</span><span class="n">RecordRoute</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kPoints</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="n">Feature</span><span class="o">&amp;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">feature_list_</span><span class="p">[</span><span class="n">feature_distribution</span><span class="p">(</span><span class="n">generator</span><span class="p">)];</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Visiting point &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">location</span><span class="p">()))</span> <span class="p">{</span>
        <span class="c1">// Broken stream.
</span><span class="c1"></span>        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span>
          <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="n">delay_distribution</span><span class="p">(</span><span class="n">generator</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="n">writer</span><span class="o">-&gt;</span><span class="n">WritesDone</span><span class="p">();</span>
    <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">writer</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Finished trip with &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">stats</span><span class="p">.</span><span class="n">point_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; points</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34;Passed &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">stats</span><span class="p">.</span><span class="n">feature_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; features</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34;Travelled &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">stats</span><span class="p">.</span><span class="n">distance</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; meters</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34;It took &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">stats</span><span class="p">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; seconds&#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;RecordRoute rpc failed.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">RouteChat</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ClientContext</span> <span class="n">context</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ClientReaderWriter</span><span class="o">&lt;</span><span class="n">RouteNote</span><span class="p">,</span> <span class="n">RouteNote</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">stream</span><span class="p">(</span>
        <span class="n">stub_</span><span class="o">-&gt;</span><span class="n">RouteChat</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">));</span>

    <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">writer</span><span class="p">([</span><span class="n">stream</span><span class="p">]()</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">RouteNote</span><span class="o">&gt;</span> <span class="n">notes</span><span class="p">{</span><span class="n">MakeRouteNote</span><span class="p">(</span><span class="s">&#34;First message&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                   <span class="n">MakeRouteNote</span><span class="p">(</span><span class="s">&#34;Second message&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                   <span class="n">MakeRouteNote</span><span class="p">(</span><span class="s">&#34;Third message&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                   <span class="n">MakeRouteNote</span><span class="p">(</span><span class="s">&#34;Fourth message&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)};</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">RouteNote</span><span class="o">&amp;</span> <span class="nl">note</span> <span class="p">:</span> <span class="n">notes</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Sending message &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">note</span><span class="p">.</span><span class="n">message</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; at &#34;</span>
                  <span class="o">&lt;&lt;</span> <span class="n">note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span>
                  <span class="o">&lt;&lt;</span> <span class="n">note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">stream</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">note</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">stream</span><span class="o">-&gt;</span><span class="n">WritesDone</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="n">RouteNote</span> <span class="n">server_note</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">stream</span><span class="o">-&gt;</span><span class="n">Read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_note</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Got message &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">server_note</span><span class="p">.</span><span class="n">message</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; at &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">server_note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">server_note</span><span class="p">.</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">stream</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;RouteChat rpc failed.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">GetOneFeature</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">point</span><span class="p">,</span> <span class="n">Feature</span><span class="o">*</span> <span class="n">feature</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ClientContext</span> <span class="n">context</span><span class="p">;</span>
    <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">stub_</span><span class="o">-&gt;</span><span class="n">GetFeature</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">feature</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;GetFeature rpc failed.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feature</span><span class="o">-&gt;</span><span class="n">has_location</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Server returns incomplete feature.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">feature</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Found no feature at &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="o">-&gt;</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="o">-&gt;</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Found feature called &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; at &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="o">-&gt;</span><span class="n">location</span><span class="p">().</span><span class="n">latitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, &#34;</span>
                <span class="o">&lt;&lt;</span> <span class="n">feature</span><span class="o">-&gt;</span><span class="n">location</span><span class="p">().</span><span class="n">longitude</span><span class="p">()</span> <span class="o">/</span> <span class="n">kCoordFactor_</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="kt">float</span> <span class="n">kCoordFactor_</span> <span class="o">=</span> <span class="mf">10000000.0</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">RouteGuide</span><span class="o">::</span><span class="n">Stub</span><span class="o">&gt;</span> <span class="n">stub_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;</span> <span class="n">feature_list_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Expect only arg: --db_path=path/to/route_guide_db.json.
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">db</span> <span class="o">=</span> <span class="n">routeguide</span><span class="o">::</span><span class="n">GetDbFileContent</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">RouteGuideClient</span> <span class="n">guide</span><span class="p">(</span>
      <span class="n">grpc</span><span class="o">::</span><span class="n">CreateChannel</span><span class="p">(</span><span class="s">&#34;localhost:50051&#34;</span><span class="p">,</span>
                          <span class="n">grpc</span><span class="o">::</span><span class="n">InsecureChannelCredentials</span><span class="p">()),</span>
      <span class="n">db</span><span class="p">);</span>

  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;-------------- GetFeature --------------&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">guide</span><span class="p">.</span><span class="n">GetFeature</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;-------------- ListFeatures --------------&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">guide</span><span class="p">.</span><span class="n">ListFeatures</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;-------------- RecordRoute --------------&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">guide</span><span class="p">.</span><span class="n">RecordRoute</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;-------------- RouteChat --------------&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">guide</span><span class="p">.</span><span class="n">RouteChat</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><h3 id="异步调用"><a href="#异步调用" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>异步调用</h3>
<p>gRPC uses the CompletionQueue API for asynchronous operations. The basic work flow is as follows:</p>
<ul>
<li>bind a CompletionQueue to an RPC call</li>
<li>do something like a read or write, present with a unique void* tag</li>
<li>call CompletionQueue::Next to wait for operations to complete. If a tag appears, it indicates that the corresponding operation is complete.</li>
</ul>
<p>greeter_async_server</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;grpc/support/log.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/grpcpp.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#ifdef BAZEL_BUILD
</span><span class="cp">#include</span> <span class="cpf">&#34;examples/protos/helloworld.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#else
</span><span class="cp">#include</span> <span class="cpf">&#34;helloworld.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#endif
</span><span class="cp"></span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Server</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerAsyncResponseWriter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerBuilder</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerCompletionQueue</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ServerContext</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">Greeter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">HelloReply</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">HelloRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServerImpl</span> <span class="k">final</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="o">~</span><span class="n">ServerImpl</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">server_</span><span class="o">-&gt;</span><span class="n">Shutdown</span><span class="p">();</span>
    <span class="c1">// Always shutdown the completion queue after the server.
</span><span class="c1"></span>    <span class="n">cq_</span><span class="o">-&gt;</span><span class="n">Shutdown</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// There is no shutdown handling in this code.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">Run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">server_address</span><span class="p">(</span><span class="s">&#34;0.0.0.0:50051&#34;</span><span class="p">);</span>

    <span class="n">ServerBuilder</span> <span class="n">builder</span><span class="p">;</span>
    <span class="c1">// Listen on the given address without any authentication mechanism.
</span><span class="c1"></span>    <span class="n">builder</span><span class="p">.</span><span class="n">AddListeningPort</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">grpc</span><span class="o">::</span><span class="n">InsecureServerCredentials</span><span class="p">());</span>
    <span class="c1">// Register &#34;service_&#34; as the instance through which we&#39;ll communicate with
</span><span class="c1"></span>    <span class="c1">// clients. In this case it corresponds to an *asynchronous* service.
</span><span class="c1"></span>    <span class="n">builder</span><span class="p">.</span><span class="n">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_</span><span class="p">);</span>
    <span class="c1">// Get hold of the completion queue used for the asynchronous communication
</span><span class="c1"></span>    <span class="c1">// with the gRPC runtime.
</span><span class="c1"></span>    <span class="n">cq_</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">AddCompletionQueue</span><span class="p">();</span>
    <span class="c1">// Finally assemble the server.
</span><span class="c1"></span>    <span class="n">server_</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">BuildAndStart</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Server listening on &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">server_address</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Proceed to the server&#39;s main loop.
</span><span class="c1"></span>    <span class="n">HandleRpcs</span><span class="p">();</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="c1">// Class encompasing the state and logic needed to serve a request.
</span><span class="c1"></span>  <span class="k">class</span> <span class="nc">CallData</span> <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
    <span class="c1">// Take in the &#34;service&#34; instance (in this case representing an asynchronous
</span><span class="c1"></span>    <span class="c1">// server) and the completion queue &#34;cq&#34; used for asynchronous communication
</span><span class="c1"></span>    <span class="c1">// with the gRPC runtime.
</span><span class="c1"></span>    <span class="n">CallData</span><span class="p">(</span><span class="n">Greeter</span><span class="o">::</span><span class="n">AsyncService</span><span class="o">*</span> <span class="n">service</span><span class="p">,</span> <span class="n">ServerCompletionQueue</span><span class="o">*</span> <span class="n">cq</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">service_</span><span class="p">(</span><span class="n">service</span><span class="p">),</span> <span class="n">cq_</span><span class="p">(</span><span class="n">cq</span><span class="p">),</span> <span class="n">responder_</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx_</span><span class="p">),</span> <span class="n">status_</span><span class="p">(</span><span class="n">CREATE</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Invoke the serving logic right away.
</span><span class="c1"></span>      <span class="n">Proceed</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">Proceed</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status_</span> <span class="o">==</span> <span class="n">CREATE</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Make this instance progress to the PROCESS state.
</span><span class="c1"></span>        <span class="n">status_</span> <span class="o">=</span> <span class="n">PROCESS</span><span class="p">;</span>

        <span class="c1">// As part of the initial CREATE state, we *request* that the system
</span><span class="c1"></span>        <span class="c1">// start processing SayHello requests. In this request, &#34;this&#34; acts are
</span><span class="c1"></span>        <span class="c1">// the tag uniquely identifying the request (so that different CallData
</span><span class="c1"></span>        <span class="c1">// instances can serve different requests concurrently), in this case
</span><span class="c1"></span>        <span class="c1">// the memory address of this CallData instance.
</span><span class="c1"></span>        <span class="n">service_</span><span class="o">-&gt;</span><span class="n">RequestSayHello</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx_</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request_</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">responder_</span><span class="p">,</span> <span class="n">cq_</span><span class="p">,</span> <span class="n">cq_</span><span class="p">,</span>
                                  <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">status_</span> <span class="o">==</span> <span class="n">PROCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Spawn a new CallData instance to serve new clients while we process
</span><span class="c1"></span>        <span class="c1">// the one for this CallData. The instance will deallocate itself as
</span><span class="c1"></span>        <span class="c1">// part of its FINISH state.
</span><span class="c1"></span>        <span class="k">new</span> <span class="n">CallData</span><span class="p">(</span><span class="n">service_</span><span class="p">,</span> <span class="n">cq_</span><span class="p">);</span>

        <span class="c1">// The actual processing.
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">(</span><span class="s">&#34;Hello &#34;</span><span class="p">);</span>
        <span class="n">reply_</span><span class="p">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">request_</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>

        <span class="c1">// And we are done! Let the gRPC runtime know we&#39;ve finished, using the
</span><span class="c1"></span>        <span class="c1">// memory address of this instance as the uniquely identifying tag for
</span><span class="c1"></span>        <span class="c1">// the event.
</span><span class="c1"></span>        <span class="n">status_</span> <span class="o">=</span> <span class="n">FINISH</span><span class="p">;</span>
        <span class="n">responder_</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="n">reply_</span><span class="p">,</span> <span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">status_</span> <span class="o">==</span> <span class="n">FINISH</span><span class="p">);</span>
        <span class="c1">// Once in the FINISH state, deallocate ourselves (CallData).
</span><span class="c1"></span>        <span class="k">delete</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

   <span class="k">private</span><span class="o">:</span>
    <span class="c1">// The means of communication with the gRPC runtime for an asynchronous
</span><span class="c1"></span>    <span class="c1">// server.
</span><span class="c1"></span>    <span class="n">Greeter</span><span class="o">::</span><span class="n">AsyncService</span><span class="o">*</span> <span class="n">service_</span><span class="p">;</span>
    <span class="c1">// The producer-consumer queue where for asynchronous server notifications.
</span><span class="c1"></span>    <span class="n">ServerCompletionQueue</span><span class="o">*</span> <span class="n">cq_</span><span class="p">;</span>
    <span class="c1">// Context for the rpc, allowing to tweak aspects of it such as the use
</span><span class="c1"></span>    <span class="c1">// of compression, authentication, as well as to send metadata back to the
</span><span class="c1"></span>    <span class="c1">// client.
</span><span class="c1"></span>    <span class="n">ServerContext</span> <span class="n">ctx_</span><span class="p">;</span>

    <span class="c1">// What we get from the client.
</span><span class="c1"></span>    <span class="n">HelloRequest</span> <span class="n">request_</span><span class="p">;</span>
    <span class="c1">// What we send back to the client.
</span><span class="c1"></span>    <span class="n">HelloReply</span> <span class="n">reply_</span><span class="p">;</span>

    <span class="c1">// The means to get back to the client.
</span><span class="c1"></span>    <span class="n">ServerAsyncResponseWriter</span><span class="o">&lt;</span><span class="n">HelloReply</span><span class="o">&gt;</span> <span class="n">responder_</span><span class="p">;</span>

    <span class="c1">// Let&#39;s implement a tiny state machine with the following states.
</span><span class="c1"></span>    <span class="k">enum</span> <span class="nc">CallStatus</span> <span class="p">{</span> <span class="n">CREATE</span><span class="p">,</span> <span class="n">PROCESS</span><span class="p">,</span> <span class="n">FINISH</span> <span class="p">};</span>
    <span class="n">CallStatus</span> <span class="n">status_</span><span class="p">;</span>  <span class="c1">// The current serving state.
</span><span class="c1"></span>  <span class="p">};</span>

  <span class="c1">// This can be run in multiple threads if needed.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">HandleRpcs</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Spawn a new CallData instance to serve new clients.
</span><span class="c1"></span>    <span class="k">new</span> <span class="n">CallData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_</span><span class="p">,</span> <span class="n">cq_</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">tag</span><span class="p">;</span>  <span class="c1">// uniquely identifies a request.
</span><span class="c1"></span>    <span class="kt">bool</span> <span class="n">ok</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Block waiting to read the next event from the completion queue. The
</span><span class="c1"></span>      <span class="c1">// event is uniquely identified by its tag, which in this case is the
</span><span class="c1"></span>      <span class="c1">// memory address of a CallData instance.
</span><span class="c1"></span>      <span class="c1">// The return value of Next should always be checked. This return value
</span><span class="c1"></span>      <span class="c1">// tells us whether there is any kind of event or cq_ is shutting down.
</span><span class="c1"></span>      <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">cq_</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tag</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ok</span><span class="p">));</span>
      <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">ok</span><span class="p">);</span>
      <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CallData</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Proceed</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ServerCompletionQueue</span><span class="o">&gt;</span> <span class="n">cq_</span><span class="p">;</span>
  <span class="n">Greeter</span><span class="o">::</span><span class="n">AsyncService</span> <span class="n">service_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Server</span><span class="o">&gt;</span> <span class="n">server_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ServerImpl</span> <span class="n">server</span><span class="p">;</span>
  <span class="n">server</span><span class="p">.</span><span class="n">Run</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><p>greeter_async_client</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;grpc/support/log.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;grpcpp/grpcpp.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#ifdef BAZEL_BUILD
</span><span class="cp">#include</span> <span class="cpf">&#34;examples/protos/helloworld.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#else
</span><span class="cp">#include</span> <span class="cpf">&#34;helloworld.grpc.pb.h&#34;</span><span class="cp">
</span><span class="cp">#endif
</span><span class="cp"></span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Channel</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientAsyncResponseReader</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">ClientContext</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">CompletionQueue</span><span class="p">;</span>
<span class="k">using</span> <span class="n">grpc</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">Greeter</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">HelloReply</span><span class="p">;</span>
<span class="k">using</span> <span class="n">helloworld</span><span class="o">::</span><span class="n">HelloRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GreeterClient</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">GreeterClient</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Channel</span><span class="o">&gt;</span> <span class="n">channel</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">stub_</span><span class="p">(</span><span class="n">Greeter</span><span class="o">::</span><span class="n">NewStub</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span> <span class="p">{}</span>

  <span class="c1">// Assembles the client&#39;s payload, sends it and presents the response back
</span><span class="c1"></span>  <span class="c1">// from the server.
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">SayHello</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Data we are sending to the server.
</span><span class="c1"></span>    <span class="n">HelloRequest</span> <span class="n">request</span><span class="p">;</span>
    <span class="n">request</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

    <span class="c1">// Container for the data we expect from the server.
</span><span class="c1"></span>    <span class="n">HelloReply</span> <span class="n">reply</span><span class="p">;</span>

    <span class="c1">// Context for the client. It could be used to convey extra information to
</span><span class="c1"></span>    <span class="c1">// the server and/or tweak certain RPC behaviors.
</span><span class="c1"></span>    <span class="n">ClientContext</span> <span class="n">context</span><span class="p">;</span>

    <span class="c1">// The producer-consumer queue we use to communicate asynchronously with the
</span><span class="c1"></span>    <span class="c1">// gRPC runtime.
</span><span class="c1"></span>    <span class="n">CompletionQueue</span> <span class="n">cq</span><span class="p">;</span>

    <span class="c1">// Storage for the status of the RPC upon completion.
</span><span class="c1"></span>    <span class="n">Status</span> <span class="n">status</span><span class="p">;</span>

    <span class="c1">// stub_-&gt;PrepareAsyncSayHello() creates an RPC object, returning
</span><span class="c1"></span>    <span class="c1">// an instance to store in &#34;call&#34; but does not actually start the RPC
</span><span class="c1"></span>    <span class="c1">// Because we are using the asynchronous API, we need to hold on to
</span><span class="c1"></span>    <span class="c1">// the &#34;call&#34; instance in order to get updates on the ongoing RPC.
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ClientAsyncResponseReader</span><span class="o">&lt;</span><span class="n">HelloReply</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">rpc</span><span class="p">(</span>
        <span class="n">stub_</span><span class="o">-&gt;</span><span class="n">PrepareAsyncSayHello</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cq</span><span class="p">));</span>

    <span class="c1">// StartCall initiates the RPC call
</span><span class="c1"></span>    <span class="n">rpc</span><span class="o">-&gt;</span><span class="n">StartCall</span><span class="p">();</span>

    <span class="c1">// Request that, upon completion of the RPC, &#34;reply&#34; be updated with the
</span><span class="c1"></span>    <span class="c1">// server&#39;s response; &#34;status&#34; with the indication of whether the operation
</span><span class="c1"></span>    <span class="c1">// was successful. Tag the request with the integer 1.
</span><span class="c1"></span>    <span class="n">rpc</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reply</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">1</span><span class="p">);</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">got_tag</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">ok</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// Block until the next result is available in the completion queue &#34;cq&#34;.
</span><span class="c1"></span>    <span class="c1">// The return value of Next should always be checked. This return value
</span><span class="c1"></span>    <span class="c1">// tells us whether there is any kind of event or the cq_ is shutting down.
</span><span class="c1"></span>    <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">cq</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="o">&amp;</span><span class="n">got_tag</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ok</span><span class="p">));</span>

    <span class="c1">// Verify that the result from &#34;cq&#34; corresponds, by its tag, our previous
</span><span class="c1"></span>    <span class="c1">// request.
</span><span class="c1"></span>    <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">got_tag</span> <span class="o">==</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">1</span><span class="p">);</span>
    <span class="c1">// ... and that the request was completed successfully. Note that &#34;ok&#34;
</span><span class="c1"></span>    <span class="c1">// corresponds solely to the request for updates introduced by Finish().
</span><span class="c1"></span>    <span class="n">GPR_ASSERT</span><span class="p">(</span><span class="n">ok</span><span class="p">);</span>

    <span class="c1">// Act upon the status of the actual RPC.
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">reply</span><span class="p">.</span><span class="n">message</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">&#34;RPC failed&#34;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="c1">// Out of the passed in Channel comes the stub, stored here, our view of the
</span><span class="c1"></span>  <span class="c1">// server&#39;s exposed services.
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="o">::</span><span class="n">Stub</span><span class="o">&gt;</span> <span class="n">stub_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Instantiate the client. It requires a channel, out of which the actual RPCs
</span><span class="c1"></span>  <span class="c1">// are created. This channel models a connection to an endpoint (in this case,
</span><span class="c1"></span>  <span class="c1">// localhost at port 50051). We indicate that the channel isn&#39;t authenticated
</span><span class="c1"></span>  <span class="c1">// (use of InsecureChannelCredentials()).
</span><span class="c1"></span>  <span class="n">GreeterClient</span> <span class="n">greeter</span><span class="p">(</span><span class="n">grpc</span><span class="o">::</span><span class="n">CreateChannel</span><span class="p">(</span>
      <span class="s">&#34;localhost:50051&#34;</span><span class="p">,</span> <span class="n">grpc</span><span class="o">::</span><span class="n">InsecureChannelCredentials</span><span class="p">()));</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">user</span><span class="p">(</span><span class="s">&#34;world&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">greeter</span><span class="p">.</span><span class="n">SayHello</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>  <span class="c1">// The actual RPC call!
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Greeter received: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">reply</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><h2 id="reference"><a href="#reference" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Reference</h2>
<ol>
<li><a href="https://developers.google.com/protocol-buffers/docs/reference/cpp-generated" target="_blank" rel="noopener">Protocol Buffers C++ Generated Code</a></li>
</ol>

            </div>

        </article>

        

        
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">作者</span>：<a href="https://liudyboy.github.io/" target="_blank" rel="noopener">liudy</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">链接</span>：<a href="/posts/protocol-buffers-note/" target="_blank" rel="noopener">https://liudyboy.github.io/posts/protocol-buffers-note/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">许可</span>：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li>
            
        </ul>
    



        
    <div class="updated-badge-container">
        <span title="Updated @ 2022-01-12 14:57:51 CST" style="cursor:help">

<svg xmlns="http://www.w3.org/2000/svg" width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2022-01-12</text><text x="915" y="140" textLength="650" transform="scale(.1)">2022-01-12</text></g></svg>
        </span></div>



        


        <div class="post-share">

        

        <div class="share-items">

            

            

            

            

            
                <div class="share-item weibo">
                    
                    <a href="https://service.weibo.com/share/share.php?&amp;url=https://liudyboy.github.io/posts/protocol-buffers-note/&amp;title=Protocol%20Buffers%20Note&amp;pic=https://liudyboy.github.io/icons/apple-touch-icon.png&amp;searchPic=false" title="分享到「新浪微博」" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon weibo-icon"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></a>
                </div>
            

            
                <div class="share-item douban">
                    
                    <a href="https://www.douban.com/share/service?href=https://liudyboy.github.io/posts/protocol-buffers-note/&amp;name=Protocol%20Buffers%20Note&amp;text=%e6%9c%ac%e6%96%87%e8%ae%b0%e5%bd%95%20protobuf%20%e7%9a%84%e7%ac%94%e8%ae%b0" title="分享到「豆瓣」" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon douban-icon"><path d="M.643.92v2.412h22.714V.92H.643zm1.974 4.926v9.42h18.764v-9.42H2.617zm2.72 2.408H18.69v4.605H5.338V8.254zm1.657 7.412l-2.512.938c1.037 1.461 1.87 2.825 2.512 4.091H0v2.385h24v-2.385h-6.678c.818-1.176 1.589-2.543 2.303-4.091l-2.73-.938a29.952 29.952 0 01-2.479 5.03h-4.75c-.786-1.962-1.677-3.641-2.672-5.03Z"/></svg></a>
                </div>
            

            
                <div class="share-item qq">
                    
                    <a href="https://connect.qq.com/widget/shareqq/index.html?url=https://liudyboy.github.io/posts/protocol-buffers-note/&amp;title=Protocol%20Buffers%20Note&amp;summary=%e6%9c%ac%e6%96%87%e8%ae%b0%e5%bd%95%20protobuf%20%e7%9a%84%e7%ac%94%e8%ae%b0&amp;pics=https://liudyboy.github.io/icons/apple-touch-icon.png&amp;site=liudy" title="分享到「QQ」" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qq-icon"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a>
                </div>
            

            
                <div class="share-item qzone">
                    
                    <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://liudyboy.github.io/posts/protocol-buffers-note/&amp;title=Protocol%20Buffers%20Note&amp;summary=%e6%9c%ac%e6%96%87%e8%ae%b0%e5%bd%95%20protobuf%20%e7%9a%84%e7%ac%94%e8%ae%b0&amp;pics=https://liudyboy.github.io/icons/apple-touch-icon.png&amp;site=liudy" title="分享到「QQ 空间」" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon qzone-icon"><path d="M23.985 9.202c-.032-.099-.127-.223-.334-.258-.207-.036-7.351-1.406-7.351-1.406s-.105-.022-.198-.07c-.092-.047-.127-.167-.127-.167S12.447.956 12.349.77C12.25.583 12.104.532 12 .532c-.104 0-.251.051-.349.238-.098.186-3.626 6.531-3.626 6.531s-.035.12-.128.167c-.092.047-.197.07-.197.07S.556 8.908.348 8.943c-.208.036-.302.16-.333.258a.477.477 0 0 0 .125.449l5.362 5.49s.072.08.119.172c.016.104.005.21.005.21s-1.189 7.242-1.22 7.45.075.369.159.43c.083.062.233.106.421.013.189-.093 6.812-3.261 6.812-3.261s.098-.044.201-.061c.103-.017.201.061.201.061s6.623 3.168 6.812 3.261c.188.094.338.049.421-.013a.463.463 0 0 0 .159-.43c-.021-.14-.93-5.677-.93-5.677.876-.54 1.425-1.039 1.849-1.747-2.594.969-6.006 1.717-9.415 1.866-.915.041-2.41.097-3.473-.015-.678-.071-1.17-.144-1.243-.438-.053-.215.054-.46.545-.831a2640.5 2640.5 0 0 1 2.861-2.155c1.285-.968 3.559-2.47 3.559-2.731 0-.285-2.144-.781-4.037-.781-1.945 0-2.275.132-2.811.168-.488.034-.769.005-.804-.138-.06-.248.183-.389.588-.568.709-.314 1.86-.594 1.984-.626.194-.052 3.082-.805 5.618-.535 1.318.14 3.244.668 3.244 1.276 0 .342-1.721 1.494-3.225 2.597-1.149.843-2.217 1.561-2.217 1.688 0 .342 3.533 1.241 6.689 1.01l.003-.022c.048-.092.119-.172.119-.172l5.362-5.49a.477.477 0 0 0 .127-.449z"/></svg></a>
                </div>
            

            
                <div class="share-item qrcode">
                    <div class="qrcode-container" title="通过「二维码」"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id="qrcode-img"></div>
                    </div>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<script>
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https:\/\/liudyboy.github.io\/posts\/protocol-buffers-note\/');
    qr.make();
    document.getElementById('qrcode-img').innerHTML = qr.createImgTag();
</script>

                </div>
            

        </div>

    </div>




        
    
    
        <div class="related-posts">
            <h2 class="related-title">相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/posts/cloudpickle-note/" class="related-link">Cloudpickle Note</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/ray_rpc-note/" class="related-link">Ray_RPC Note</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/ray_system_design-note/" class="related-link">Ray_system_design Note</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/ray_workflow-note/" class="related-link">Ray_workflow Note</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/ray_raylet-note/" class="related-link">Ray_raylet Note</a>
                    </li>
                
            </ul>
        </div>
    



        
    
        <div class="post-tags">
            
                
                
                
                
                    
                    <a href="/tags/ray/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>ray</a>
                
            
                
                
                
                
                    
                    <a href="/tags/protobuf/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>protobuf</a>
                
            
        </div>
    



        


        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/posts/ray_system_design-note/" rel="prev">&lt; Ray_system_design Note</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/posts/ray_workflow-note/" rel="next">Ray_workflow Note &gt;</a>
                </li>
            
        </ul>
    



        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="site-info">©&nbsp;2020–2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;liudy</div><div class="site-copyright"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></div>

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="mailto:liudy95@foxmail.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://github.com/liudyboy" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li></ul>
    



            
        </div>
    </footer>


        </div>
        
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>

<script>
    var scroll = new SmoothScroll('a[href*="#"]', {
        speedAsDuration: true,
        header: '[data-scroll-header]'
    });
</script>






    <script>
    if (typeof MathJax === 'undefined') {
        window.MathJax = {
            loader: {
                load: ['[tex]/mhchem']
            },
            
            tex: {
                inlineMath: {'[+]': [['$', '$']]},
                tags: 'ams',
                packages: {'[+]': ['mhchem']}
            }
        };
        (function() {
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js';
            script.defer = true;
            document.head.appendChild(script);
        })();
    } else {
        MathJax.texReset();
        MathJax.typeset();
    }
</script>








    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    mediumZoom(document.querySelectorAll('div.post-body img'), {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>







    
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    




    </body>
</html>
